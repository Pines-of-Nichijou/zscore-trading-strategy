// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © nichu211

//@version=6
library("OKXSignalLogic", overlay=false)

// Helper function to get position string
export getPositionString(float pos) =>
    result = switch
        pos > 0 => "ENTER_LONG"
        pos < 0 => "ENTER_SHORT"
        => "EXIT"
    result

// Base alert message generator
export getAlertMsg(string action, string instrument, string signalToken, string orderType="market", float orderPriceOffset=0.0, string investmentType="percentage_investment", float amount=100.0) =>
    str = "{"
    str := str + '"action": "' + action + '", '
    str := str + '"instrument": "' + instrument + '", '
    str := str + '"signalToken": "' + signalToken + '", '
    str := str + '"timestamp": "' + str.format_time(timenow, "yyyy-MM-dd'T'HH:mm:ssZ", "UTC+0") + '", '
    str := str + '"orderType": "' + orderType + '", '
    str := str + '"orderPriceOffset": "' + str.tostring(orderPriceOffset) + '", '
    str := str + '"investmentType": "' + investmentType + '", '
    str := str + '"amount": "' + str.tostring(amount) + '"'
    str := str + "}"
    str

// Strategy-specific alert message generator
export method generateStrategyMessage(string action, string signalToken, float amount) => 
    getAlertMsg(action=action, instrument=syminfo.ticker, signalToken=signalToken, amount=amount)

// Manual signal alert message generator
export generateManualMessage(string action, string signalToken, float amount, string orderType="market", float priceOffset=0.0, string investmentType="percentage_investment") => 
    getAlertMsg(action=action, instrument=syminfo.ticker, signalToken=signalToken, orderType=orderType, orderPriceOffset=priceOffset, investmentType=investmentType, amount=amount)
